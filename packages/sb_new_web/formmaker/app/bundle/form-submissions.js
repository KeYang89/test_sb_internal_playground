!function(s){function t(o){if(i[o])return i[o].exports;var e=i[o]={exports:{},id:o,loaded:!1};return s[o].call(e.exports,e,e.exports,t),e.loaded=!0,e.exports}var i={};return t.m=s,t.c=i,t.p="",t(0)}({0:function(s,t,i){"use strict";s.exports={el:"#formmaker-submissions",data:function(){return _.merge({submissions:!1,submissionID:0,pages:0,count:"",selected:[]},window.$data)},created:function(){this.resource=this.$resource("api/formmaker/submission{/id}",{},{"export":{method:"post",url:"api/formmaker/submission/csv"}}),this.config.filter=_.extend({status:"",form:"",order:"created desc"},this.config.filter)},events:{"close.submissionmodal":function(){this.$url.current.hash&&(window.history.replaceState({},"",this.$url.current.href.replace("#"+this.$url.current.hash,"")),this.$url.current.hash="")},"close.csvmodal":function(){this.load()}},watch:{"config.page":"load","config.filter":{handler:function(){this.load(0)},deep:!0}},computed:{statusOptions:function(){var s=_.map(this.statuses,function(s,t){return{text:s,value:t}});return[{text:this.$trans("Status"),value:""},{text:this.$trans("Show all"),value:"all"},{label:this.$trans("Filter by"),options:s}]},formOptions:function(){var s=_.map(this.forms,function(s){return{text:s.title,value:s.id}});return[{text:this.$trans("Form"),value:""},{label:this.$trans("Filter by"),options:s}]}},methods:{load:function(s){var t=this;s=void 0!==s?s:this.config.page,this.resource.query({filter:this.config.filter,page:s}).then(function(i){t.$set("submissions",i.data.submissions),t.$set("pages",i.data.pages),t.$set("count",i.data.count),t.$set("config.page",s),t.$set("selected",[]),t.checkDetailHash()})},checkDetailHash:function(){if(this.$url.current.hash){var s=parseInt(this.$url.current.hash,10),t=_.find(this.submissions,function(t){return t.id===s});t&&this.submissionDetails(t)}},active:function(s){return-1!==this.selected.indexOf(s.id)},getSelected:function(){var s=this;return this.submissions.filter(function(t){return-1!==s.selected.indexOf(t.id)})},getStatusText:function(s){return this.statuses[s.status]},status:function(s,t){var i=this;t=t||this.getSelected(),t.forEach(function(t){return t.status=s}),this.resource.save({id:"bulk"},{submissions:t}).then(function(){i.load(),i.$notify("Submission(s) saved.")})},toggleStatus:function(s){var t=this;s.status=2===s.status?0:s.status+1,this.resource.save({id:s.id},{submission:s}).then(function(){t.load(),t.$notify("Submission saved.")})},removeSubmissions:function(){var s=this;this.resource["delete"]({id:"bulk"},{ids:this.selected}).then(function(){s.load(),s.$notify("Submission(s) deleted.")})},submissionDetails:function(s){window.history.replaceState({},"",this.$url.current.href.replace("#"+this.$url.current.hash,"")+"#"+s.id),this.$url.current.hash="#"+s.id,this.submissionID=s.id,this.$refs.submissionmodal.open()},formatValue:function(s){return window.Formmakerfields.components[s.type]&&"function"==typeof window.Formmakerfields.components[s.type].formatValue?window.Formmakerfields.components[s.type].formatValue.apply(this,[s]):"string"==typeof s.value?[s.value]:s.value}},components:{submissiondetail:i(48),submissioncsv:i(47)}},i(1)(Vue),Vue.ready(s.exports)},1:function(s,t){"use strict";s.exports=function(s){s.filter("datetime",function(s){return"string"==typeof s&&(s=new Date(s)),s?this.$date(s,"mediumDate")+", "+this.$date(s,"HH:mm:ss"):""}),s.filter("shortcode",function(s,t){return"$$ "+s+":"+t+" $$"})}},16:function(s,t){"use strict";s.exports={props:["forms"],data:function(){return{options:{form_id:0,filename:"csv-export.csv",mark_archived:!0,status:[1,2],field_ids:[],datafields:["id","status","email","ip","created"]},formitem:{id:0,fields:[]},csvLink:"",exporting:!1,count:0,loaded:!1}},created:function(){this.load()},beforeDestroy:function(){this.$dispatch("close.csvmodal")},computed:{formLoaded:function(){return this.options.form_id&&this.options.form_id==this.formitem.id}},methods:{load:function(){var s=this;this.$root.resource.query({id:"csv",options:this.options}).then(function(t){var i=t.data;s.$set("options.field_ids",i.options.field_ids),s.$set("options.filename",i.options.filename),i.forms.length&&(s.$set("count",0),s.$set("forms",i.forms)),i.formitem.id&&(s.$set("formitem",i.formitem),s.$set("formitem.fields",i.fields),s.$set("count",i.count),s.options.filename="export_"+s.formitem.slug+".csv"),s.loaded=!0})},doExport:function(){var s=this;return this.exporting||!this.options.form_id||this.formitem.id!==this.options.form_id?!1:(this.exporting=!0,void this.$root.resource["export"]({options:this.options}).then(function(t){if(t.data.csv){var i=window.URL||window.webkitURL;s.csvLink=i.createObjectURL(new Blob([t.data.csv],{type:"application/force-download"})),s.exporting=!1}}))}},watch:{options:{handler:function(s){this.csvLink=""},deep:!0},"options.form_id,options.status":function(s){this.load()}}}},17:function(s,t){"use strict";s.exports={data:function(){return{submission:{status:null},loaded:!1}},props:["submissionid"],created:function(){var s=this;this.$root.resource.query({id:"detail",submission_id:this.submissionid}).then(function(t){s.submission=t.data,s.loaded=!0})},beforeDestroy:function(){this.$dispatch("close.submissionmodal")},watch:{"submission.status":function(s,t){null!==t&&t!==s&&this.$root.status(s,[this.submission])}}}},33:function(s,t){s.exports="<div> <div class=uk-modal-header> <h2>{{ 'Export submissions as CSV file' | trans }}</h2> </div> <div class=\"uk-margin uk-form uk-form-stacked\"> <div class=uk-modal-spinner v-if=!loaded></div> <div v-show=loaded> <div class=uk-grid> <div class=uk-width-medium-1-2> <select class=uk-width-1-1 v-model=options.form_id number> <option value=\"\">{{ 'Select form' | trans }}</option> <option v-for=\"form in forms\" :value=form.id>{{ form.title }}</option> </select> </div> <div class=uk-width-medium-1-2> <div class=\"uk-form-controls uk-form-controls-text uk-flex uk-margin-small-top\"> <div class=uk-width-1-3> <label><input type=checkbox :value=0 v-model=options.status number> {{ 'Archived' | trans }}</label> </div> <div class=uk-width-1-3> <label><input type=checkbox :value=1 v-model=options.status number> {{ 'Active' | trans }}</label> </div> <div class=uk-width-1-3> <label><input type=checkbox :value=2 v-model=options.status number> {{ 'Done' | trans }}</label> </div> </div> </div> </div> <div class=uk-grid v-if=formLoaded> <div class=uk-width-medium-2-3> <div class=uk-grid> <div class=uk-width-medium-1-2> <div class=uk-form-row> <span class=uk-form-label>{{ 'Data to export' | trans }}</span> <div class=\"uk-form-controls uk-form-controls-text\"> <p class=uk-form-controls-condensed> <label><input type=checkbox value=id v-model=options.datafields> {{ 'Id' | trans }}</label> </p> <p class=uk-form-controls-condensed> <label><input type=checkbox value=status v-model=options.datafields> {{ 'Status' | trans }}</label> </p> <p class=uk-form-controls-condensed> <label><input type=checkbox value=email v-model=options.datafields> {{ 'Email' | trans }}</label> </p> <p class=uk-form-controls-condensed> <label><input type=checkbox value=ip v-model=options.datafields> {{ 'IP address' | trans }}</label> </p> <p class=uk-form-controls-condensed> <label><input type=checkbox value=created v-model=options.datafields> {{ 'Created' | trans }}</label> </p> </div> </div> </div> <div class=uk-width-medium-1-2> <div class=uk-form-row> <span class=uk-form-label>{{ 'Fields to export' | trans }}</span> <div class=\"uk-form-controls uk-form-controls-text\"> <p v-for=\"field in formitem.fields\" class=uk-form-controls-condensed> <label><input type=checkbox value=\"{{ field.id }}\" v-model=options.field_ids number> {{ field.label | trans }}</label> </p> </div> </div> </div> </div> </div> <div class=uk-width-medium-1-3> <div class=\"uk-panel uk-panel-box\"> <div class=uk-form-row> <label for=form-filename class=uk-form-label>{{ 'Filename' | trans }}</label> <div class=uk-form-controls> <input id=form-filename class=uk-width-1-1 type=text v-model=options.filename> </div> </div> <div class=uk-form-row> <span class=uk-form-label>{{ 'Archive' | trans }}</span> <div class=\"uk-form-controls uk-form-controls-text\"> <label><input type=checkbox value=archived v-model=options.mark_archived> {{ 'Mark exported as \"Archived\"' | trans }}</label> </div> </div> <div class=\"uk-badge uk-badge-success uk-margin\"> {{ count }} {{ '{0} submissions to be exported|{1} submission to be exported|]1,Inf[ submissions to be exported' | transChoice count}} </div> </div> </div> </div> </div> </div> <div class=\"uk-modal-footer uk-text-right\"> <button type=button class=\"uk-button uk-modal-close\">{{ 'Close' | trans }}</button> <button type=button class=\"uk-button uk-button-primary\" v-show=!csvLink @click=doExport v-el:export :disabled=!formLoaded> <i v-show=exporting class=\"uk-icon-spinner uk-icon-spin\"></i> <span v-else>{{ 'Export' | trans }}</span> </button> <a :href=csvLink class=\"uk-button uk-button-success\" download=\"{{ options.filename }}\" v-show=csvLink v-el:exportlink> <i class=\"uk-icon-download uk-margin-small-right\"></i>{{ 'Download' | trans }}</a> </div> </div>"},34:function(s,t){s.exports="<div class=uk-modal-spinner v-if=!loaded></div> <div v-show=loaded> <div class=uk-grid> <div class=uk-width-medium-3-4> <h2 class=uk-margin-top-remove>{{ 'Submission for form \"%formtitle%\"' | trans {formtitle:submission.form_title} }}</h2> <dl class=\"uk-description-list uk-description-list-horizontal\"> <dt>{{ 'Submission date' | trans }}</dt><dd>{{ submission.created | datetime }}</dd> <dt>{{ 'Submission status' | trans }}</dt><dd :class=\"{'uk-text-danger': submission.status == 0,\n							  'uk-text-primary': submission.status == 1,\n							  'uk-text-success': submission.status == 2}\">{{ $root.getStatusText(submission) | trans }}</dd> <dt>{{ 'Remote IP address' | trans }}</dt><dd>{{ submission.ip }}</dd> <dt>{{ 'Email sent to' | trans }}</dt> <dd> <a v-if=submission.email href=\"mailto:{{ submission.email }}\">{{ submission.email }}</a> <span v-else>{{ 'No email provided' | trans }}</span> </dd> </dl> <h3>{{ 'Submission data' | trans }}</h3> <dl class=\"uk-description-list uk-description-list-horizontal\"> <template v-for=\"fieldsubmission in submission.fieldsubmissions\"> <dt>{{ fieldsubmission.field.label}}</dt> <dd v-for=\"value in fieldsubmission.formatted\">{{{ value }}}</dd> </template> </dl> </div> <div class=\"uk-width-medium-1-4 uk-form\"> <div class=uk-form-row> <label for=form-status class=uk-form-label>{{ 'Status' | trans }}</label> <div class=uk-form-controls> <select id=form-status class=uk-width-1-1 v-model=submission.status number> <option v-for=\"option in $root.statuses\" :value=$key>{{ option }}</option> </select> </div> </div> </div> </div> </div> <div class=\"uk-modal-footer uk-text-right\"> <button type=button class=\"uk-button uk-modal-close\">{{ 'Close' | trans }}</button> </div>"},47:function(s,t,i){var o,e;o=i(16),e=i(33),s.exports=o||{},s.exports.__esModule&&(s.exports=s.exports["default"]),e&&(("function"==typeof s.exports?s.exports.options||(s.exports.options={}):s.exports).template=e)},48:function(s,t,i){var o,e;o=i(17),e=i(34),s.exports=o||{},s.exports.__esModule&&(s.exports=s.exports["default"]),e&&(("function"==typeof s.exports?s.exports.options||(s.exports.options={}):s.exports).template=e)}});